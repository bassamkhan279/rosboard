#!/usr/bin/env python3
import threading
import subprocess
import pathlib
import rosboard.login_server

print("[ROSBoard] ðŸš€ Starting combined backend + login server...")

BASE_DIR = pathlib.Path(__file__).parent / "rosboard"

def start_backend():
    print("[ROSBoard] ðŸ”§ Launching backend on port 8899...")
    backend_path = BASE_DIR / "rosboard.py"
    if not backend_path.exists():
        print(f"[ERROR] Backend file not found at: {backend_path}")
        return
    # âœ… Run backend directly, not as a module
    subprocess.Popen(["python3", str(backend_path), "--port", "8899"])

# Start backend in a background thread
backend_thread = threading.Thread(target=start_backend, daemon=True)
backend_thread.start()

# Start login server in the main thread
rosboard.login_server.main()

print("[ROSBoard] âœ… All services running. Access:")
print("   Login:   http://localhost:8888")
print("   Backend: http://localhost:8899")

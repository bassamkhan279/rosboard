#!/usr/bin/env python3
import threading
import subprocess
import pathlib
import rosboard.login_server

print("[ROSBoard] ðŸš€ Starting combined backend + login server...")

# Set base directory to current folder
BASE_DIR = pathlib.Path(__file__).parent

def start_backend():
    print("[ROSBoard] ðŸ”§ Launching backend on port 8899 (listening on all IPs)...")
    # This command starts the backend and allows external connections
    subprocess.Popen(
        ["python3", "-m", "rosboard", "--port", "8899", "--host", "0.0.0.0"], 
        cwd=BASE_DIR
    )

# Start backend in background thread
backend_thread = threading.Thread(target=start_backend, daemon=True)
backend_thread.start()

# Start login server (this will block the main thread)
print("[ROSBoard] ðŸ”§ Starting login server on port 8888...")
rosboard.login_server.main()
